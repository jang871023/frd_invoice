<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Invoice Generator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-1Thin.woff') format('woff');
      font-weight: 100;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-2ExtraLight.woff') format('woff');
      font-weight: 200;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff') format('woff');
      font-weight: 300;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-4Regular.woff') format('woff');
      font-weight: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-5Medium.woff') format('woff');
      font-weight: 500;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-6Bold.woff') format('woff');
      font-weight: 600;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-7ExtraBold.woff') format('woff');
      font-weight: 700;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-8Heavy.woff') format('woff');
      font-weight: 800;
      font-display: swap;
    }

    @font-face {
      font-family: 'Escoredream';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-9Black.woff') format('woff');
      font-weight: 900;
      font-display: swap;
    }
    body {
      margin: 0;
      font-family: "Escoredream", sans-serif;
      color:#4b4b4b;
      font-size: 12px;
    }
    .container {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 420px;
      height: 100%;
      background: #e6e6e6;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid #ccc;
      gap:2px;
    }
    .sidebar h3 {
      margin-top: 0;
    }
    .sidebar label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }

    .sidebar select,
    .sidebar button {
      width: 100%;
      margin-top: 5px;
      padding: 8px;
      box-sizing: border-box;
    }
    .sidebar input {
      border-radius: 3px;
      background:#f4f4f4;
      border:none;

    }
    table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
      background: #fff;
    }
    table td, table th {
      border: 1px solid #ccc;
      padding: 5px;
      text-align: left;
    }

    .main-area {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      background: #fff;
      height: 100%;            /* ì¶”ê°€ */
      overflow-y: auto;
    }
    canvas {
      border: 1px solid #ccc;
    }
    .autocomplete-box {
      position: relative;
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 150px;
      overflow-y: auto;
      display: none;
      z-index: 999;
    }

    .autocomplete-item {
      padding: 8px;
      cursor: pointer;
    }

    .autocomplete-item:hover {
      background: #eee;
    }
    /* í–‰ ê°„ê²© */
    .form-row {
      display: flex;
      gap: 20px;            /* ì¢Œìš° ê°„ê²© ì—¬ìœ  ìˆê²Œ */
      margin-bottom: 12px;  /* í–‰ ê°„ê²© */
    }

    /* í•œ ì¹¸ ìš”ì†Œ */
    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* ë¼ë²¨ */
    .form-group label {
      margin-bottom: 5px;
      font-weight: bold;
    }

    /* ì¸í’‹ */
    .form-group input {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #f4f4f4;
      font-size: 14px;
    }

    #stampPreview img {
      width: 80px;
      opacity: 0.9;
      margin-top: 5px;
    }
    /* =======================
   ğŸ“± Mobile Layout
   ======================= */
    @media (max-width: 768px) {
  .container {
    flex-direction: column;
    height: auto;   /* ë†’ì´ ìë™ */
  }

  .sidebar {
    width: 100%;
    height: auto;   /* ëª¨ë°”ì¼ì—ì„œ ë†’ì´ ìë™ */
    border-right: none;
    border-bottom: 1px solid #ccc;
    padding: 10px;
    overflow-y: auto;  /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
  }

  .main-area {
    width: 100%;
    height: auto;       /* main-area ë†’ì´ ìë™ */
    padding: 10px;
    justify-content: center;
    overflow-x: auto;   /* ê°€ë¡œ ë„˜ì¹¨ ë°©ì§€ */
    overflow-y: auto;   /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
  }

  canvas {
    width: 100% !important;
    height: auto !important;
    max-width: 800px;   /* ì›ë˜ canvas ë¹„ìœ¨ ìœ ì§€ */
  }

  .form-row {
    flex-direction: column;  /* ëª¨ë°”ì¼ì—ì„œ 1ì—´ì”© */
    gap: 10px;
  }
}

    input, select, textarea, button {
      font-family: "Escoredream", sans-serif !important;
    }
    .tabs { display:flex; border-bottom:2px solid #ddd; }
    .tab { padding:12px 18px; cursor:pointer; font-weight:800; }
    .tab.active { border-bottom:3px solid #000; }


    .tab-content { display:none; padding:15px; }
    .tab-content.active { display:block; }
    .form-row {
      display: flex;
      gap: 3px;

      align-items: center;  /* â† ì´ê±° ì¶”ê°€í•˜ë©´ ìˆ˜í‰ ì •ë ¬ ê¹”ë”í•˜ê²Œ ë§ìŒ */
    }


    .form-row .form-group {
      flex: 1;
    }
    .form-group select{
      border:none;
      height:32px;
      font-size: 12px;
      color:#4b4b4b;
    }









  </style>
</head>
<body>

<div class="container">

  <!-- --------------------------------------- -->
  <!--               SIDEBAR                   -->
  <!-- --------------------------------------- -->
  <aside class="sidebar">

    <h3 style="background-color:#000000; padding:7px; color:white; border-radius:5px;">ê³µì‚¬ ì •ë³´</h3>

    <div class="form-row">
      <div class="form-group">
        <label>ê³µì‚¬ëª…</label>
        <input id="workNameInput" type="text" style="border:none;">
      </div>

      <div class="form-group">
        <label>ì œì¶œì²˜</label>
        <input id="submitToInput" type="text" style="border:none;">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>ì°¸ê³ </label>
        <input id="refInput" type="text" style="border:none;">
      </div>

      <div class="form-group">
        <label>ë°œí–‰ ì¼ì</label>
        <input id="issueDateInput" type="date" style="border:none;">
      </div>
    </div >

    <div class="form-row">
      <div class="form-group">
        <label>ë°œí–‰ ë²ˆí˜¸</label>
        <input id="issueNumberInput" type="text" style="border:none;">
      </div>


    </div>
    <hr>
    <h4 style="background-color:#000000; padding:7px; color:white; border-radius:5px;">íšŒì‚¬ ì •ë³´</h4>
    <div class="form-row">
      <div class="form-group">
        <label>ìƒí˜¸</label>
        <input id="companyNameInput" type="text" value="ëŒ€ë•ENG" style="border:none;">

      </div>
      <div class="form-group">
        <label>ì‚¬ì—…ìë²ˆí˜¸</label>
        <input id="bizNumberInput" type="text" value='171-41-01658' style="border:none;">
      </div>


    </div>

    <div class="form-row">
      <div class="form-group">
        <label>ì£¼ì†Œ</label>
        <input id="companyAddressInput" type="text" value="ì„œìš¸ì‹œ ì†¡íŒŒêµ¬ ì†¡íŒŒë™93-5" style="border:none;">
      </div>

    </div>
    <div class="form-row">
      <div class="form-group">
        <label>ëŒ€í‘œì</label>
        <input id="ceoInput" type="text" value="ì´ì€íœ˜" style="border:none;">
      </div>


    </div>
    <div class="form-group">
      <label>ì§ì¸</label>
      <button id="addStampBtn" type="button" style="border:none;">ì§ì¸ ì¶”ê°€</button>
    </div>

    <!-- ìŠ¤íƒ¬í”„ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
    <div id="stampPreview" style="margin-top:10px; text-align:center;"></div>






    <hr>

    <h3 style="background-color:#000000; padding:7px; color:white; border-radius:5px;">ë‹¨ê°€ í…Œì´ë¸”</h3>

    <label>í’ˆëª©ëª…</label>
    <input id="itemInput" type="text" autocomplete="off">
    <div id="autocompleteBox" class="autocomplete-box"></div>

    <div class="form-row">
      <div class="form-group">
        <label>ë‹¨ìœ„</label>
        <select id="unitInput">
          <option value="ê°œ">ê°œ</option>
          <option value="ì¸">ì¸</option>
          <option value="m">ê±´</option>
          <option value="kg">ì¡°</option>
          <option value="EA">EA</option>
          <option value="dae">ëŒ€</option>
          <option value="meter">ë¯¸í„°</option>
        </select>
      </div>

      <div class="form-group">
        <label>ìˆ˜ëŸ‰</label>
        <input id="qtyInput" type="number">
      </div>

      <div class="form-group">
        <label>ë‹¨ê°€</label>
        <input id="priceInput" type="number">
      </div>
    </div>



    <button id="addItemBtn" style="color:#4b4b4b; border:none; border-radius:5px;"><i class="fa-solid fa-circle-plus"></i></button>

    <table id="itemTable">
      <thead>
      <tr style="font-size: 12px; ">
        <th style="text-align:center;">í•­ëª©</th>
        <th style="text-align:center;">í’ˆëª© ë° ëª…ì„¸</th>
        <th style="text-align:center;">ìˆ˜ëŸ‰</th>
        <th style="text-align:center;">ê°œë‹¹ ë‹¨ê°€</th>
        <th style="text-align:center;">ê¸ˆì•¡</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>

    <hr>

    <label>í…œí”Œë¦¿ ì„ íƒ</label>
    <div class="select" style="display: flex; flex-direction: row; align-items: center; gap:5px;">
      <select id="templateSelect" style="flex:5;  border:none; border-radius:5px;" >
        <option value="template1">ì¸ë³´ì´ìŠ¤ 1</option>
        <option value="template2">ì¸ë³´ì´ìŠ¤ 2</option>
      </select>
      <button id="downloadPngBtn" style="flex:0.5; border-radius: 3px; border:none;"><i class="fa-solid fa-floppy-disk" style="color:#4b4b4b;"></i></button>
    </div>



  </aside>

  <!-- --------------------------------------- -->
  <!--               MAIN AREA                 -->
  <!-- --------------------------------------- -->
  <main class="main-area">
    <canvas id="invoiceCanvas" width="800" height="1100"></canvas>
  </main>

</div>

<script>
  // ===============================
  // PNG ë‹¤ìš´ë¡œë“œ
  // ===============================
  document.getElementById("downloadPngBtn").addEventListener("click", () => {
    const link = document.createElement("a");
    link.download = "invoice.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });

  // ===============================
  // ìë™ì™„ì„± ë°ì´í„°
  // ===============================
  const itemSuggestions = [
    "ê¸°ë³¸ ì¶œì¥ë¹„",
    "ë¶€í’ˆ êµì²´",
    "ì„¸ì²™ ì„œë¹„ìŠ¤",
    "í•„í„° êµí™˜",
    "ì„¤ì¹˜ ë¹„ìš©",
    "ìˆ˜ë¦¬ ë¹„ìš©",
    "ì¶”ê°€ ì‘ì—… ë¹„ìš©",
    "ë¶€ê°€ì„¸",
    "ì¬ë£Œë¹„",
    "ì‘ì—…ë¹„"
  ];

  const itemInput = document.getElementById("itemInput");
  const autoBox = document.getElementById("autocompleteBox");

  itemInput.addEventListener("input", function () {
    const keyword = this.value.trim();
    autoBox.innerHTML = "";

    if (keyword === "") {
      autoBox.style.display = "none";
      return;
    }

    const filtered = itemSuggestions.filter(item => item.includes(keyword));

    if (filtered.length === 0) {
      autoBox.style.display = "none";
      return;
    }

    filtered.forEach(text => {
      const div = document.createElement("div");
      div.className = "autocomplete-item";
      div.textContent = text;

      div.addEventListener("click", () => {
        itemInput.value = text;
        autoBox.style.display = "none";
      });

      autoBox.appendChild(div);
    });

    autoBox.style.display = "block";
  });

  document.addEventListener("click", (e) => {
    if (!autoBox.contains(e.target) && e.target !== itemInput) {
      autoBox.style.display = "none";
    }
  });

  // ===============================
  // Canvas ì…‹ì—…
  // ===============================
  const canvas = document.getElementById("invoiceCanvas");
  const ctx = canvas.getContext("2d");

  // ===============================
  // í•­ëª© ë¦¬ìŠ¤íŠ¸
  // ===============================
  let itemList = [];

  // ===============================
  // í…œí”Œë¦¿ ì¢Œí‘œ ì„¤ì •
  // ===============================
  const invoiceLayouts = {
    template1: {
      name: { x: 120, y: 80 },
      date: { x: 300, y: 80 },

      company: {
        workName: { x: 120, y: 140 },
        submitTo: { x: 120, y: 170 },
        ref: { x: 120, y: 200 },
        issueDate: { x: 120, y: 230 },
        issueNumber: { x: 120, y: 260 },

        companyName: { x: 430, y: 140 },
        bizNumber: { x: 430, y: 170 },
        address: { x: 430, y: 200 },
        ceo: { x: 430, y: 230 }
      },

      stampDefaultX: 600,
      stampDefaultY: 130,

      itemStartY: 330,
      itemGap: 35
    },

    template2: {
      name: { x: 150, y: 90 },
      date: { x: 350, y: 90 },

      company: {
        workName: { x: 515, y: 210 },
        submitTo: { x: 600, y: 235 },
        ref: { x: 150, y: 210 },
        issueDate: { x: 600, y: 282 },
        issueNumber: { x: 150, y: 270 },

        companyName: { x: 100, y: 150+40 },
        bizNumber: { x: 100, y: 180+40 },
        address: { x: 100, y: 210+40 },
        ceo: { x: 100, y: 240+40 }
      },

      stampDefaultX: 620,
      stampDefaultY: 160,

      itemStartY: 400,
      itemGap: 40
    }
  };

  let currentTemplate = "template2";

  // ===============================
  // í…œí”Œë¦¿ ì´ë¯¸ì§€ ë¡œë“œ
  // ===============================
  function loadTemplate() {
    const img = new Image();
    img.src = `templates/${currentTemplate}.png`;

    img.onload = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      drawTexts();
      drawItemRows();
      drawStamp();
    };
  }

  // ===============================
  // ê¸°ë³¸ í…ìŠ¤íŠ¸
  // ===============================
  function drawTexts() {
    const L = invoiceLayouts[currentTemplate];

    ctx.font = "500 18px Escoredream";  // â† ìˆ˜ì •ë¨
    ctx.fillStyle = "#25354f";



    ctx.fillText(document.getElementById("workNameInput").value, L.company.workName.x, L.company.workName.y);
    ctx.fillText(document.getElementById("submitToInput").value, L.company.submitTo.x, L.company.submitTo.y);
    ctx.fillText(document.getElementById("refInput").value, L.company.ref.x, L.company.ref.y);
    ctx.fillText(document.getElementById("issueDateInput").value, L.company.issueDate.x, L.company.issueDate.y);
    ctx.fillText(document.getElementById("issueNumberInput").value, L.company.issueNumber.x, L.company.issueNumber.y);

    ctx.fillText(document.getElementById("companyNameInput").value, L.company.companyName.x, L.company.companyName.y);
    ctx.fillText(document.getElementById("bizNumberInput").value, L.company.bizNumber.x, L.company.bizNumber.y);
    ctx.fillText(document.getElementById("companyAddressInput").value, L.company.address.x, L.company.address.y);
    ctx.fillText(document.getElementById("ceoInput").value, L.company.ceo.x, L.company.ceo.y);
  }

  // ===============================
  // í•­ëª© ê·¸ë¦¬ê¸°
  // ===============================
  function drawItemRows() {
    const L = invoiceLayouts[currentTemplate];
    let y = L.itemStartY;

    let totalAmount = 0;

    // -------------------------
    // í•­ëª© ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
    // -------------------------
    itemList.forEach(item => {
      const amount = Number(item.amount) || 0;
      totalAmount += amount;

      const qty = item.qty ?? "";
      const unit = item.unit ?? "";

      ctx.fillText(item.name, 130, y);
      ctx.fillText(item.subject ?? "", 320, y);

      ctx.fillText(qty, 310, y);
      ctx.fillText("/", 350, y);
      ctx.fillText(unit, 375, y);

      ctx.fillText((Number(item.price) || 0).toLocaleString(), 455, y);
      ctx.fillText(amount.toLocaleString(), 570, y);

      y += L.itemGap;
    });

    // -------------------------
    // ê³„ì‚°
    // -------------------------
    const option1 = Math.round(totalAmount * 0.10);  // 10%
    const option2 = Math.round(totalAmount * 0.05);  // 5%
    const finalAmount = totalAmount + option1 + option2;

    // -------------------------
    // ì¶œë ¥ ìœ„ì¹˜ (í•„ìš”í•˜ë©´ ë„¤ ìœ„ì¹˜ë¡œ ì¡°ì •í•´ì¤„ê²Œ)
    // -------------------------
    // option1
    ctx.fillText(option1.toLocaleString() + "ì›", 570, 795);
    ctx.fillText(option2.toLocaleString() + "ì›", 570, 825);

    // â˜… finalAmount (ìµœì¢… ê¸ˆì•¡)
    ctx.font = "800 26px Escoredream";   // â† í°íŠ¸ í¬ê¸° + ë‘ê»˜ ì¦ê°€
    ctx.fillStyle = "#25354f";
    ctx.fillText(finalAmount.toLocaleString() + "ì›",  570, 950);
  }



  // ===============================
  // ì§ì¸ (ë“œë˜ê·¸ + ìœ„ì¹˜ ìœ ì§€ + 50% ì¶•ì†Œ)
  // ===============================
  let stampEnabled = false;
  let stampImage = new Image();
  stampImage.src = "img/stamp1.png";

  let stampX = invoiceLayouts[currentTemplate].stampDefaultX;
  let stampY = invoiceLayouts[currentTemplate].stampDefaultY;

  let stampW = 120;
  let stampH = 120;

  let isDraggingStamp = false;
  let offsetX = 0;
  let offsetY = 0;

  // 50% í¬ê¸° ì ìš© í›„ í´ë¦­ ë°•ìŠ¤ë„ ë™ì¼í•˜ê²Œ ì„¤ì •
  stampImage.onload = () => {
    stampW = stampImage.width * 0.5;
    stampH = stampImage.height * 0.5;
    loadTemplate();
  };

  function drawStamp() {
    if (!stampEnabled) return;

    ctx.drawImage(stampImage, stampX, stampY, stampW, stampH);
  }

  document.getElementById("addStampBtn").addEventListener("click", () => {
    stampEnabled = !stampEnabled;

    const previewDiv = document.getElementById("stampPreview");
    previewDiv.innerHTML = stampEnabled ? `<img src="img/stamp1.png" style="width:80px;">` : "";

    loadTemplate();
  });

  // ===============================
  // ë§ˆìš°ìŠ¤ ì¢Œí‘œ ë³´ì • (CSS ìŠ¤ì¼€ì¼ ëŒ€ì‘)
  // ===============================
  function getMousePos(canvas, e) {
    const rect = canvas.getBoundingClientRect();
    return {
      x: (e.clientX - rect.left) * (canvas.width / rect.width),
      y: (e.clientY - rect.top) * (canvas.height / rect.height)
    };
  }

  // ===============================
  // ë“œë˜ê·¸ ê¸°ëŠ¥
  // ===============================
  canvas.addEventListener("mousedown", (e) => {
    if (!stampEnabled) return;

    const pos = getMousePos(canvas, e);
    const x = pos.x, y = pos.y;

    if (x >= stampX && x <= stampX + stampW &&
      y >= stampY && y <= stampY + stampH) {

      isDraggingStamp = true;
      offsetX = x - stampX;
      offsetY = y - stampY;
    }
  });

  canvas.addEventListener("mousemove", (e) => {
    if (!isDraggingStamp) return;

    const pos = getMousePos(canvas, e);

    stampX = pos.x - offsetX;
    stampY = pos.y - offsetY;

    loadTemplate();
  });

  canvas.addEventListener("mouseup", () => {
    isDraggingStamp = false;
  });

  canvas.addEventListener("mouseleave", () => {
    isDraggingStamp = false;
  });

  // ===============================
  // í•­ëª© ì¶”ê°€ ë²„íŠ¼
  // ===============================
  document.getElementById("addItemBtn").addEventListener("click", () => {
    const name = document.getElementById("itemInput").value;
    const unit = document.getElementById("unitInput").value;
    const qty = parseInt(document.getElementById("qtyInput").value);
    const price = parseInt(document.getElementById("priceInput").value);

    if (!name || !qty || !price) return;

    const amount = qty * price;

    itemList.push({ name, unit, qty, price, amount });

    const tbody = document.querySelector("#itemTable tbody");
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${name}</td>
      <td>${unit}</td>
      <td>${qty}</td>
      <td>${price.toLocaleString()}</td>
      <td>${amount.toLocaleString()}</td>`;
    tbody.appendChild(tr);

    document.getElementById("itemInput").value = "";
    document.getElementById("qtyInput").value = "";
    document.getElementById("priceInput").value = "";

    loadTemplate();
  });



  // ===============================
  // ì…ë ¥ ë‚´ìš© ë³€í™” ì¦‰ì‹œ ë°˜ì˜
  // ===============================
  document.querySelectorAll("input").forEach(el => {
    el.addEventListener("input", loadTemplate);
  });

  document.getElementById("templateSelect").addEventListener("change", e => {
    currentTemplate = e.target.value;

    const L = invoiceLayouts[currentTemplate];
    stampX = L.stampDefaultX;
    stampY = L.stampDefaultY;

    loadTemplate();
  });

  // ì´ˆê¸° ì‹¤í–‰
  loadTemplate();
</script>


</body>
</html>
